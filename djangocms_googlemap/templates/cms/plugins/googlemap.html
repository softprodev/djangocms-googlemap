{% load i18n sekizai_tags %}

{% addtoblock "js" %}
  <script type="text/javascript">
function replaceAll(originalString ,search, replacement) {
      return originalString.replace(new RegExp(search, 'g'), replacement);
};
function initializeMap{{ object.pk}}() {
      // save settings form plugin
      var container = 'google-map-{{ object.pk }}';
      var latlng = new google.maps.LatLng(46.94708, 7.445975); // default to switzerland

      var title = "{{ object.get_title }}";
      var address = "{{ object.address }}, {{ object.zipcode }} {{ object.city }}";

      //var style = [{"featureType":"administrative","elementType":"labels.text.fill","stylers":[{"color":"#444444"}]},{"featureType":"administrative.neighborhood","elementType":"geometry.fill","stylers":[{"visibility":"off"},{"hue":"#17ff00"}]},{"featureType":"administrative.neighborhood","elementType":"labels.text.fill","stylers":[{"visibility":"on"}]},{"featureType":"landscape","elementType":"all","stylers":[{"color":"#f2f2f2"}]},{"featureType":"poi","elementType":"all","stylers":[{"visibility":"off"}]},{"featureType":"poi.business","elementType":"all","stylers":[{"visibility":"off"}]},{"featureType":"poi.business","elementType":"labels.text","stylers":[{"visibility":"off"}]},{"featureType":"poi.business","elementType":"labels.text.fill","stylers":[{"visibility":"off"}]},{"featureType":"road","elementType":"all","stylers":[{"saturation":-100},{"lightness":45}]},{"featureType":"road.highway","elementType":"all","stylers":[{"visibility":"simplified"}]},{"featureType":"road.highway","elementType":"geometry.fill","stylers":[{"color":"#a61d21"}]},{"featureType":"road.arterial","elementType":"labels.icon","stylers":[{"visibility":"off"}]},{"featureType":"road.local","elementType":"geometry.fill","stylers":[{"visibility":"on"}]},{"featureType":"transit","elementType":"all","stylers":[{"visibility":"off"}]},{"featureType":"water","elementType":"all","stylers":[{"color":"#07436a"},{"visibility":"on"}]}];
      //var style = JSON.parse(replaceAll("[{&quot;featureType&quot;:&quot;administrative&quot;,&quot;elementType&quot;:&quot;labels.text.fill&quot;,&quot;stylers&quot;:[{&quot;color&quot;:&quot;#444444&quot;}]},{&quot;featureType&quot;:&quot;administrative.neighborhood&quot;,&quot;elementType&quot;:&quot;geometry.fill&quot;,&quot;stylers&quot;:[{&quot;visibility&quot;:&quot;off&quot;},{&quot;hue&quot;:&quot;#17ff00&quot;}]},{&quot;featureType&quot;:&quot;administrative.neighborhood&quot;,&quot;elementType&quot;:&quot;labels.text.fill&quot;,&quot;stylers&quot;:[{&quot;visibility&quot;:&quot;on&quot;}]},{&quot;featureType&quot;:&quot;landscape&quot;,&quot;elementType&quot;:&quot;all&quot;,&quot;stylers&quot;:[{&quot;color&quot;:&quot;#f2f2f2&quot;}]},{&quot;featureType&quot;:&quot;poi&quot;,&quot;elementType&quot;:&quot;all&quot;,&quot;stylers&quot;:[{&quot;visibility&quot;:&quot;off&quot;}]},{&quot;featureType&quot;:&quot;poi.business&quot;,&quot;elementType&quot;:&quot;all&quot;,&quot;stylers&quot;:[{&quot;visibility&quot;:&quot;off&quot;}]},{&quot;featureType&quot;:&quot;poi.business&quot;,&quot;elementType&quot;:&quot;labels.text&quot;,&quot;stylers&quot;:[{&quot;visibility&quot;:&quot;off&quot;}]},{&quot;featureType&quot;:&quot;poi.business&quot;,&quot;elementType&quot;:&quot;labels.text.fill&quot;,&quot;stylers&quot;:[{&quot;visibility&quot;:&quot;off&quot;}]},{&quot;featureType&quot;:&quot;road&quot;,&quot;elementType&quot;:&quot;all&quot;,&quot;stylers&quot;:[{&quot;saturation&quot;:-100},{&quot;lightness&quot;:45}]},{&quot;featureType&quot;:&quot;road.highway&quot;,&quot;elementType&quot;:&quot;all&quot;,&quot;stylers&quot;:[{&quot;visibility&quot;:&quot;simplified&quot;}]},{&quot;featureType&quot;:&quot;road.highway&quot;,&quot;elementType&quot;:&quot;geometry.fill&quot;,&quot;stylers&quot;:[{&quot;color&quot;:&quot;#a61d21&quot;}]},{&quot;featureType&quot;:&quot;road.arterial&quot;,&quot;elementType&quot;:&quot;labels.icon&quot;,&quot;stylers&quot;:[{&quot;visibility&quot;:&quot;off&quot;}]},{&quot;featureType&quot;:&quot;road.local&quot;,&quot;elementType&quot;:&quot;geometry.fill&quot;,&quot;stylers&quot;:[{&quot;visibility&quot;:&quot;on&quot;}]},{&quot;featureType&quot;:&quot;transit&quot;,&quot;elementType&quot;:&quot;all&quot;,&quot;stylers&quot;:[{&quot;visibility&quot;:&quot;off&quot;}]},{&quot;featureType&quot;:&quot;water&quot;,&quot;elementType&quot;:&quot;all&quot;,&quot;stylers&quot;:[{&quot;color&quot;:&quot;#07436a&quot;},{&quot;visibility&quot;:&quot;on&quot;}]}];","&quote", "\""));
      {% if object.style %}
        var style = JSON.parse(replaceAll(replaceAll("{{ object.style }}","&quot", "\""),";",""));
      {% else %}
        var style = null;
      {% endif %}
      var options = {
        zoom: {{ object.zoom }},
        mapTypeId: google.maps.MapTypeId.ROADMAP, /* ROADMAP, SATELLITE, HYBRID or TERRAIN */
        scrollwheel: {{ object.scrollwheel|lower }},
        disableDoubleClickZoom: {% if object.double_click_zoom %}false{% else %}true{% endif %},
        draggable: {{ object.draggable|lower}},
        keyboardShortcuts: {{ object.keyboard_shortcuts|lower}},
        panControl: {{ object.pan_control|lower}},
        zoomControl: {{ object.zoom_control|lower}},
        streetViewControl: {{ object.street_view_control|lower}}
      };

      {% if object.get_lat_lng %}
        // load latlng from given lat lng settings
        latlng = new google.maps.LatLng({{ object.get_lat_lng|join:", " }});
        initGoogleMaps(latlng);
      {% else %}
        // load latlng from given address
        var geocoder = new google.maps.Geocoder();
          geocoder.geocode({'address': address}, function (results, status) {
            // check if address can be found if not show default (var latlng)
            if(status == google.maps.GeocoderStatus.OK) latlng = results[0].geometry.location;
            initGoogleMaps(latlng);
          });
      {% endif %}

      // initialize google maps
      function initGoogleMaps(latlng) {
        // overwrite options
        options.center = latlng;
        // initialize google map
        var styledMap = new google.maps.StyledMapType(style, {name: "Styled Map"});
        var map = new google.maps.Map(document.getElementById(container), options);

        //Set styles
        map.mapTypes.set('map_style', styledMap);
        map.setMapTypeId('map_style');

        // create marker
        var marker = new google.maps.Marker({
          'position': options.center,
          'map': map,
          'title': title
        });
        {% if object.info_window %}
        // prepare info window
        var content = "";
        if (title) content += "<strong>" + title + "</strong><br />";
        content += address {% if object.content %} + "<br /> \
                   <br /><em>{{ object.content }}</em>"{% endif %}
        var infowindow = new google.maps.InfoWindow({
          content: content
        });
        // show info window
        infowindow.open(map, marker);
        {% endif %}
      }
    };
  </script>
{% endaddtoblock %}

{% addtoblock "js" %}
<script type="text/javascript" src="https://maps-api-ssl.google.com/maps/api/js?v=3&amp;callback=initializeMap{{ object.pk }}"></script>
{% endaddtoblock %}



<div class="plugin_googlemap">
  {% if object.get_title %}<h2>{{ object.get_title }}</h2>{% endif %}

  <div id="google-map-{{ object.pk }}" class="google-map-container"
       style="width: {{ object.width }}; height: {{ object.height }};"></div>

  {% if object.route_planer %}
    <form action="http://maps.google.com/" method="get" class="frm google-map-routeplaner">
      <fieldset>
        <h3 class="nospace">{{ object.route_planer_title }}:</h3>
        <p>
          <label for="saddr-{{ object.pk }}">{% trans "Your address: " %}</label>
          <input type="text" id="saddr-{{ object.pk }}" name="saddr" class="input_text" />
          <span class="btn"><input type="submit" value="{% trans 'Calculate route' %}" /></span>
          <input type="hidden" name="daddr" value="{{ object.address }}, {{ object.zipcode }} {{ object.city }}" />
        </p>
      </fieldset>
    </form>
  {% endif %}
</div>
